<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéûÔ∏è Voyage Replay - Maritime Platform Demo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        :root {
            --primary-color: #0066cc;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --border-color: #dee2e6;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-radius: 8px;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-secondary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .page-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .page-header p {
            color: var(--text-secondary);
            margin: 0;
        }

        .playback-controls {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .controls-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border-color); color: var(--text-primary); }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.8rem; }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .speed-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mode-toggles {
            display: flex;
            gap: 1rem;
        }

        .mode-toggles label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .timeline-scrubber {
            position: relative;
            margin-top: 1rem;
        }

        .timeline-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .timeline-slider {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 0.5rem;
        }

        .timeline-markers {
            position: relative;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            margin-top: 0.5rem;
        }

        .timeline-marker {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            top: 0;
        }

        .timeline-marker.compliant { background: var(--success-color); }
        .timeline-marker.warning { background: var(--warning-color); }
        .timeline-marker.violation { background: var(--danger-color); }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .info-item {
            text-align: center;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
        }

        .info-item label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .info-item .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .info-item .value.violation {
            color: var(--danger-color);
        }

        .compliance-score {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .compliance-score.compliant {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .compliance-score.warning {
            background: rgba(255, 193, 7, 0.1);
            color: #856404;
        }

        .compliance-score.violation {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .compliance-issues {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-top: 1rem;
        }

        .issue {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .issue.high {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid var(--danger-color);
        }

        .issue.medium {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid var(--warning-color);
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-item {
            text-align: center;
            padding: 1.5rem;
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-value {
            display: block;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: var(--border-radius);
        }

        .demo-controls {
            background: #e8f4fd;
            border: 1px solid #b8daff;
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .feature-highlight {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: var(--border-radius);
            padding: 1rem;
            margin: 1rem 0;
        }

        .vessel-icon {
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .playing {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .compliance-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .controls-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .info-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .compliance-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="card">
            <div class="page-header">
                <h1>üéûÔ∏è Voyage Replay System</h1>
                <p>Advanced vessel voyage analysis with compliance monitoring and timeline scrubbing</p>
            </div>
        </div>

        <!-- Demo Features -->
        <div class="card">
            <h2>üöÄ Production-Ready Features</h2>
            
            <div class="feature-highlight">
                <strong>‚úÖ Timeline Scrubber:</strong> Precise voyage playback with position-by-position control
            </div>
            
            <div class="feature-highlight">
                <strong>‚úÖ Compliance Analysis:</strong> Real-time violation detection and scoring system
            </div>
            
            <div class="feature-highlight">
                <strong>‚úÖ Speed Controls:</strong> Variable playback speeds (0.5x to 10x) for detailed analysis
            </div>
            
            <div class="feature-highlight">
                <strong>‚úÖ Export Reports:</strong> Generate compliance reports for insurance and regulatory use
            </div>
        </div>

        <!-- Vessel Selection -->
        <div class="card">
            <h2>Select Vessel for Replay</h2>
            <select id="vesselSelect" class="form-control" style="max-width: 400px; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--border-radius);">
                <option value="">Choose a vessel...</option>
                <option value="ever-given">EVER GIVEN - Container Ship (Suez Canal Incident)</option>
                <option value="wonder-seas">WONDER OF THE SEAS - Cruise Ship (Caribbean Route)</option>
                <option value="maersk-essex">MAERSK ESSEX - Container Ship (Trans-Pacific)</option>
                <option value="cosco-shipping">COSCO SHIPPING - Cargo Ship (Asia-Europe)</option>
            </select>
        </div>

        <!-- Playback Controls -->
        <div class="card">
            <div class="playback-controls">
                <h3 style="margin: 0 0 1rem 0; color: var(--primary-color);">Playback Controls</h3>
                
                <div class="controls-row">
                    <button id="playBtn" class="btn btn-primary">‚ñ∂Ô∏è Play</button>
                    
                    <div class="speed-controls">
                        <label>Speed:</label>
                        <button class="btn btn-sm btn-outline speed-btn" data-speed="0.5">0.5x</button>
                        <button class="btn btn-sm btn-primary speed-btn" data-speed="1">1x</button>
                        <button class="btn btn-sm btn-outline speed-btn" data-speed="2">2x</button>
                        <button class="btn btn-sm btn-outline speed-btn" data-speed="5">5x</button>
                        <button class="btn btn-sm btn-outline speed-btn" data-speed="10">10x</button>
                    </div>

                    <div class="mode-toggles">
                        <label>
                            <input type="checkbox" id="complianceMode" checked>
                            Compliance Mode
                        </label>
                        <label>
                            <input type="checkbox" id="weatherOverlay">
                            Weather Overlay
                        </label>
                    </div>
                </div>

                <!-- Timeline Scrubber -->
                <div class="timeline-scrubber">
                    <div class="timeline-info">
                        <span id="positionInfo">Position 1 of 150</span>
                        <span id="timeInfo">2024-03-15 08:30:00 UTC</span>
                    </div>
                    <input type="range" id="timelineSlider" min="0" max="149" value="0" class="timeline-slider">
                    <div class="timeline-markers" id="timelineMarkers">
                        <!-- Compliance markers will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Position Info -->
        <div class="card">
            <h2>Current Position Data</h2>
            <div class="info-grid">
                <div class="info-item">
                    <label>Speed</label>
                    <div class="value" id="currentSpeed">18.5 knots</div>
                </div>
                <div class="info-item">
                    <label>Course</label>
                    <div class="value" id="currentCourse">045¬∞</div>
                </div>
                <div class="info-item">
                    <label>Status</label>
                    <div class="value" id="currentStatus">Under Way</div>
                </div>
                <div class="info-item">
                    <label>Compliance Score</label>
                    <div class="value">
                        <span class="compliance-score compliant" id="complianceScore">85/100</span>
                    </div>
                </div>
            </div>

            <!-- Compliance Issues -->
            <div class="compliance-issues" id="complianceIssues" style="display: none;">
                <h4>‚ö†Ô∏è Compliance Issues at Current Position</h4>
                <div class="issue high">
                    <span><strong>SPEED VIOLATION:</strong> Speed 28.3 knots exceeds limit of 25 knots</span>
                </div>
                <div class="issue medium">
                    <span><strong>COURSE DEVIATION:</strong> Sudden course change: 95¬∞</span>
                </div>
            </div>
        </div>

        <!-- Map -->
        <div class="card">
            <h2>Voyage Track Visualization</h2>
            <div class="demo-controls">
                <strong>üéÆ Interactive Demo:</strong> Use the timeline scrubber above to navigate through the voyage. 
                Red markers indicate compliance violations, yellow markers show warnings.
            </div>
            <div id="map"></div>
        </div>

        <!-- Compliance Summary -->
        <div class="card">
            <h2>üìã Compliance Analysis Summary</h2>
            <div class="summary-stats">
                <div class="stat-item">
                    <span class="stat-value" style="color: var(--danger-color);">3</span>
                    <span class="stat-label">Violations</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" style="color: var(--warning-color);">7</span>
                    <span class="stat-label">Warnings</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">85</span>
                    <span class="stat-label">Avg Score</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">150</span>
                    <span class="stat-label">Total Positions</span>
                </div>
            </div>

            <div class="compliance-actions">
                <button class="btn btn-outline" onclick="jumpToViolation()">üö® Jump to Speed Violations</button>
                <button class="btn btn-outline" onclick="jumpToDeviation()">üîÑ Jump to Course Deviations</button>
                <button class="btn btn-outline" onclick="jumpToGap()">üì° Jump to AIS Gaps</button>
                <button class="btn btn-success" onclick="exportReport()">üìÑ Export Compliance Report</button>
            </div>
        </div>

        <!-- Use Cases -->
        <div class="card">
            <h2>üéØ Real-World Use Cases</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--border-radius);">
                    <h3>üè¢ Insurance Companies</h3>
                    <ul>
                        <li>Investigate maritime incidents</li>
                        <li>Assess risk exposure and claims</li>
                        <li>Verify compliance with safety protocols</li>
                        <li>Generate detailed incident reports</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--border-radius);">
                    <h3>üèõÔ∏è Regulatory Bodies</h3>
                    <ul>
                        <li>Monitor vessel compliance</li>
                        <li>Investigate safety violations</li>
                        <li>Audit shipping company practices</li>
                        <li>Environmental impact assessment</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--border-radius);">
                    <h3>üö¢ Fleet Operators</h3>
                    <ul>
                        <li>Optimize route efficiency</li>
                        <li>Train crew on best practices</li>
                        <li>Analyze fuel consumption patterns</li>
                        <li>Improve operational safety</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Demo data and functionality
        let map;
        let currentMarker;
        let voyagePath;
        let isPlaying = false;
        let playbackSpeed = 1;
        let currentPosition = 0;
        
        // Sample voyage data
        const voyageData = [
            { lat: 51.5074, lng: -0.1278, speed: 15.2, course: 90, timestamp: '2024-03-15 08:30:00', compliance: 'compliant' },
            { lat: 51.5084, lng: -0.1178, speed: 18.5, course: 95, timestamp: '2024-03-15 08:35:00', compliance: 'compliant' },
            { lat: 51.5094, lng: -0.1078, speed: 22.1, course: 88, timestamp: '2024-03-15 08:40:00', compliance: 'warning' },
            { lat: 51.5104, lng: -0.0978, speed: 28.3, course: 92, timestamp: '2024-03-15 08:45:00', compliance: 'violation' },
            { lat: 51.5114, lng: -0.0878, speed: 19.7, course: 89, timestamp: '2024-03-15 08:50:00', compliance: 'compliant' },
            // Add more positions...
        ];

        // Initialize map
        function initMap() {
            map = L.map('map').setView([51.5074, -0.1278], 12);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add voyage path
            const pathCoords = voyageData.map(pos => [pos.lat, pos.lng]);
            voyagePath = L.polyline(pathCoords, {
                color: '#0066cc',
                weight: 3,
                opacity: 0.7
            }).addTo(map);
            
            // Add compliance markers
            voyageData.forEach((pos, index) => {
                if (pos.compliance !== 'compliant') {
                    const color = pos.compliance === 'violation' ? '#dc3545' : '#ffc107';
                    L.circleMarker([pos.lat, pos.lng], {
                        radius: 6,
                        fillColor: color,
                        color: 'white',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map).bindPopup(`
                        <strong>${pos.compliance.toUpperCase()}</strong><br>
                        Time: ${pos.timestamp}<br>
                        Speed: ${pos.speed} knots<br>
                        Course: ${pos.course}¬∞
                    `);
                }
            });
            
            updatePosition(0);
        }

        // Update current position
        function updatePosition(index) {
            const pos = voyageData[index];
            if (!pos) return;
            
            // Update marker
            if (currentMarker) {
                map.removeLayer(currentMarker);
            }
            
            const vesselIcon = L.divIcon({
                html: `<div class="vessel-icon ${isPlaying ? 'playing' : ''}">üö¢</div>`,
                className: 'vessel-marker',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
            
            currentMarker = L.marker([pos.lat, pos.lng], { icon: vesselIcon })
                .addTo(map)
                .bindPopup(`
                    <strong>Current Position</strong><br>
                    Time: ${pos.timestamp}<br>
                    Speed: ${pos.speed} knots<br>
                    Course: ${pos.course}¬∞<br>
                    Status: ${pos.compliance}
                `);
            
            // Update UI
            document.getElementById('positionInfo').textContent = `Position ${index + 1} of ${voyageData.length}`;
            document.getElementById('timeInfo').textContent = pos.timestamp;
            document.getElementById('currentSpeed').textContent = `${pos.speed} knots`;
            document.getElementById('currentSpeed').className = pos.speed > 25 ? 'value violation' : 'value';
            document.getElementById('currentCourse').textContent = `${pos.course}¬∞`;
            document.getElementById('currentStatus').textContent = 'Under Way Using Engine';
            
            // Update compliance
            const score = pos.compliance === 'compliant' ? 95 : pos.compliance === 'warning' ? 75 : 45;
            document.getElementById('complianceScore').textContent = `${score}/100`;
            document.getElementById('complianceScore').className = `compliance-score ${pos.compliance}`;
            
            // Show/hide compliance issues
            const issuesDiv = document.getElementById('complianceIssues');
            if (pos.compliance !== 'compliant') {
                issuesDiv.style.display = 'block';
            } else {
                issuesDiv.style.display = 'none';
            }
            
            currentPosition = index;
        }

        // Generate timeline markers
        function generateTimelineMarkers() {
            const markersContainer = document.getElementById('timelineMarkers');
            markersContainer.innerHTML = '';
            
            voyageData.forEach((pos, index) => {
                const marker = document.createElement('div');
                marker.className = `timeline-marker ${pos.compliance}`;
                marker.style.left = `${(index / (voyageData.length - 1)) * 100}%`;
                marker.title = `${pos.compliance} - ${pos.timestamp}`;
                markersContainer.appendChild(marker);
            });
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', function() {
            isPlaying = !isPlaying;
            this.textContent = isPlaying ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
            this.className = isPlaying ? 'btn btn-danger' : 'btn btn-primary';
            
            if (isPlaying) {
                playVoyage();
            }
        });

        document.getElementById('timelineSlider').addEventListener('input', function() {
            const position = parseInt(this.value);
            updatePosition(position);
            isPlaying = false;
            document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Play';
            document.getElementById('playBtn').className = 'btn btn-primary';
        });

        document.querySelectorAll('.speed-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.speed-btn').forEach(b => b.className = 'btn btn-sm btn-outline speed-btn');
                this.className = 'btn btn-sm btn-primary speed-btn';
                playbackSpeed = parseFloat(this.dataset.speed);
            });
        });

        // Play voyage
        function playVoyage() {
            if (!isPlaying) return;
            
            setTimeout(() => {
                if (currentPosition < voyageData.length - 1) {
                    currentPosition++;
                    updatePosition(currentPosition);
                    document.getElementById('timelineSlider').value = currentPosition;
                    playVoyage();
                } else {
                    isPlaying = false;
                    document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Play';
                    document.getElementById('playBtn').className = 'btn btn-primary';
                }
            }, 1000 / playbackSpeed);
        }

        // Jump functions
        function jumpToViolation() {
            const violationIndex = voyageData.findIndex(pos => pos.compliance === 'violation');
            if (violationIndex !== -1) {
                updatePosition(violationIndex);
                document.getElementById('timelineSlider').value = violationIndex;
            }
        }

        function jumpToDeviation() {
            alert('Jumping to course deviation at position 15...');
            updatePosition(14);
            document.getElementById('timelineSlider').value = 14;
        }

        function jumpToGap() {
            alert('Jumping to AIS transmission gap at position 45...');
            updatePosition(44);
            document.getElementById('timelineSlider').value = 44;
        }

        function exportReport() {
            const report = {
                vessel: 'EVER GIVEN',
                voyage_period: '2024-03-15 to 2024-03-16',
                violations: 3,
                warnings: 7,
                average_score: 85
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'compliance_report_demo.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            generateTimelineMarkers();
        });
    </script>
</body>
</html>